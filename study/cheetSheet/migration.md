## 마이그레이션
### 테이블
| id | 걸그룹 | 멤버 이름 | 소속사 |
|----|------|---------|------|
| 1 | 트와이스 | 사나 | JYP |
| 2 | 트와이스 | 나연 | JYP |
| 3 | 블랙핑크 | 지수 | YG |
| 4 | 러블리즈 | 케이 | woollim |
| 5 | 소녀시대 | 윤아 | SM |

- 테이블은 `표`와 같은 방식으로 데이터를 저장하기 위한 데이터베이스의 기능이다.

### 데이터베이스
- 데이터베이스는 데이터를 저장히기 위한 테이블을 만들 수 있는 곳으로 데이터를 저장하고 조회하기 위한 다양한 기능들을 제공한다. 데이터베이스를 다루기 위해서는 '쿼리'라는 명령을 사용한다.
- 일반적으로 데이터베이스를 다루기 위한 쿼리 명령은 데이터베이스 프로그램을 통해서 사용할 수 있다.
- 프로그래밍 언어에서 데이터베이스를 다루기 위해서는 프로그래밍 언어로 데이터베이스 프로그램을 컨트롤하여 원하는 쿼리를 데이터베이스 프로그램이 실행할 수 있도록 하는 방식으로 사용된다.
- 따라서 프로그래밍 언어에서 데이터베이스를 사용하기 위해서는 프로그래밍 언어와 데이터베이스 프로그램을 연결하는 기능이 필요하며 데이터베이스 프로그램에 프로그래밍 언어가 명령을 전달하여 쿼리를 실행하도록 할 필요가 있다.

## 엑티브레코드
- 데이터베이스를 사용하기 위해서는 쿼리라는 데이터베이스를 다룰 때 사용하는 명령어를 알아야 한다.
- 많은 웹 프레임워크와 라이브러리는 프로그래밍 언어를 사용해서 쿼리를 정의하는 방법을 제공한다. 데이터베이스를 조작하기 위해서는 쿼리라는 것을 알아야 하는데, 쿼리를 몰라도 라이브러리나 프레임워크가 제공하는 명령을 사용하면 된다.
- 루비온 레일즈에서 쿼리를 몰라도 데이터베이스를 다룰 수 있도록 도와주는 도구 중 하나가 엑티브레코드이다.

## 흐름
1. 엑티브 레코드가 제공하는 기능과 루비 언어를 사용해서 데이터베이스를 다루는 명령을 정의한다.
2. 엑티브 레코드가 프로그래밍 언어를 쿼리로 변환하여 데이터베이스로 쿼리를 전달한다.
3. 데이터베이스 프로그램은 전달 받은 쿼리를 실행한다.
4. 쿼리에 따라 데이터베이스에 저장된 데이터의 변경 또는 저장 방식의 변경 또는 저장된 데이터의 조회 명령을 수행한다.
5. 명령을 수행한 결과 값을 데이터베이스가 엑티브레코드에 전달한다.
6. 엑티브레코드가 프로그래밍 언어의 값으로 데이터 변환하여 루비 언어를 통해 데이터를 다룰 수 있게 된다.

## 마이그레이션이란?
- 마이그레이션이란 데이터베이스를 구성하는데 필요한 쿼리를 실행하기 위한 명령을 데이터베이스에 전달하는 과정을 의미한다.
- 마이그레이션을 하는 대표적인 작업은 데이터를 저장히기 위한 테이블을 만드는 작업이다.

## 모델
- 모델은 데이터베이스의 테이블을 레일즈에서 엑티브레코드로 다룰 수 있도록 하기 위한 기능이다.
- 모델은 테이블에 들어 있는 데이터를 적절히 가공하는 역할을 한다.

## 모델과 마이그레이션 만들어 보기
```sh
rails g model Photo path:string caption:text
```
- 레일즈에서는 `rails g model 모델명 컬럼1:타입 컬럼2:타입 컬럼3:타입 ...`과 같은 방식으로 모델과 마이그레이션 파일을 만들 수 있다.
- 마이그레이션 파일을 만들지 않고 모델 파일만 만드는 경우에는 `레일즈에서는 `rails g model 모델명`만 터미널에 입력한다.
- 마이그레이션 파일을 만들나서 이 마이그레이션 파일을 `rake db:migrate`라는 명령으로 터미널에서 실행하면 마이그레이션 파일을 통해서 데이터 베이스의 구조를 바꿀 수 있다.
- 생성된 마이그레이션 파일은 `path:string caption:text`와 같은 데이블을 만드는데 이 파일은 다음과 같이 표 형식으로 데이터를 저장할 수 있는 테이블을 데이터베이스에 생성한다.
| id | path | caption |
|----|------|---------|
| 1 | 사진첩/초코 케이크.png | 생일날 먹은 케익 |
| 2 | 사진첩/남방 돌고래.jpg | 제주도 놀러 갔을 때 남방 돌고래 찍은 사진 |

### 실행 결과
- `rails g model Photo path:string caption:text` 명령을 실행한 결과이다.
```
      invoke  active_record
      create    db/migrate/20230518155320_create_photos.rb
      create    app/models/photo.rb
      invoke    test_unit
      create      test/models/photo_test.rb
      create      test/fixtures/photos.yml
```
- `db/migrate/20230518155320_create_photos.rb`라는 마이그레이션 파일이 생성된다. 이 파일로 데이터베이스에 테이블을 형성할 수 있다.
- `app/models/photo.rb`라는 모델 파일이 생성된다. 이 파일로 루비의 엑티브레코드로 데이터베이스에 생성된 테이블에 데이터를 저장하거나, 데이터를 변경하거나, 데이터를 삭제할 수 있다.
- 나머지 파일은 유닛 태스트용의 파일인데 지금 단계에서는 무시해도 좋다.

## 마이그레이션 실행하기
- 마이그레이션 파일은 데이터베이스의 구조를 변경하기 위한 코드가 포함되어 있는 파일이다.
- `db/migrate/20230518155320_create_photos.rb` 경로의 파일을 열어 보자.
```rb
class CreatePhotos < ActiveRecord::Migration[7.0]
  def change
    create_table :photos do |t|
      t.string :path
      t.text :caption

      t.timestamps
    end
  end
end
```
- `CreatePhotos` 클래스는 마이그레이션 파일에 데이터베이스의 구조를 변경하기 위한 명령을 정의하는 부분이다.
- `ActiveRecord::Migration`에서 `ActiveRecord`는 데이터베이스의 구조를 다루기 위한 기능들이 포함되어 있는 곳이다. 많은 기능들 중에서 `ActiveRecord`클래스에 포함되어 있는 `Migration` 클래스를 `CreatePhotos` 클래스에 상속하겠다는 의미이다. 따라서 `CreatePhotos` 클래스는 `ActiveRecord::Migration` 클래스가 갖고 있는 기능들을 사용할 수 있는 클래스가 된다.
- 클래스 내부에 `def change ... end`의 형태로 함수를 적어 주었다. `change` 함수는 테이블에 관련한 코드를 지정할 수 있다. `change` 함수 안을 보면 테이블을 생성하는 명령 `create_table`이 사용되었다는 것을 알 수 있다.
- 테이블을 생성할 때는 컬럼(=세로 줄인 열)을 지정해 주어야 한다. 컬럼은 데이터를 저장할 공간에 어떤 데이터를 저장할 것인지를 결정한다. 예를 들어 `string` 타입의 컬럼인 `path`와 `text` 타입의 컬럼인 `caption`을 지정하면 데이터를 저장할 때 `path`와 `caption`에 해당하는 데이터 세트가 저장이 된다. 컬럼에 무엇을 어떻게 얼마나 정의하냐에 따라 저장되는 데이터 세트의 구성이 달라진다.